<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" href="lib/qunit/qunit.css" type="text/css" media="screen" />
		<script src="lib/qunit/qunit.js"></script>

        <script src="../ulib.utils.js"></script>
        <script src="../ulib.pubsub.js"></script>
		<script src="../ulib.plugin.js"></script>
		<script src="../../sole/dist/sole-latest.js"></script>
	</head>
<body>
    <script>
        (function() {

	    	//	Use a private plugin object, rather than the ulib global
            var pm = new ulib.PluginManager({
                //  Config object - passed to all plugins
                config: {
                    allowAccess: true,
                    urlList: [],
                    userPrefs: {
                        show: true,
                        timeout: 20000
                    }
                },
                //  Plugin config - passed to individual plugins
                pluginConfig: {
                    //  Name of our plugin, and any values for it
                    'dataHandler': {
                        showData: true
                    }
                }//,

            });

            //console.log(xpm);


	        //  Plugin 1

            //  Private vars and functions
            var stuff = ['something'],
                handleData = function() {
                    console.log("handleData", arguments);
                    //console.log.apply(console.log,arguments);
                    return arguments;
                };

            //  The plugin
            pm.add( "somePlugin", function(config) {

            	console.log('plugin',this.name, this.get());

            	console.log("settings1", config);
            	//config.allowAccess = false;

            	//	Dynamic subscription to event
                this.on('output', function(data) {
	            	console.log('eventName',this.eventName, this.set);
                    handleData(data);
                    this.set('hello', { name: 'world', userPrefs: this.get('userPrefs') });
                });

                console.log("exp", this.expose.toString());

                this.on('args', function() {
                	console.log('args test', arguments);
                });

                var mySecret = 'hello';

                var xp = this.expose(function(a){
                	console.log("XXXPPP", mySecret,a,this.name);
                }, this);

                //	Share a function for other plugins
                this.set('awesomefunc',xp);

            });

            //  Private vars and functions
            //  The plugin
            pm.add( "dataHandler", function(config) {
            	console.log("config.showData", config.showData);
            	alert("one");
            });

            //  The plugin
            pm.add( "dataHandler", function(config) {

            	console.log("config.showData", config.showData);

            	console.log('plugin',this.name);

            	console.log("settings2", config);

                this.on('output', function(data) {
                    console.log('hello', this.get('hello'));
                });

                var xp = this.get('awesomefunc');
                xp('world');

                //	Test triggering and error handeling
                this.on('triggerError', function(reason) {
                	console.log('triggerError', reason);
                });

                this.trigger('args', 'blah', 1, 'two', 3);

                //this.trigger('pause', 'blah');
                //this.trigger('init', 'blah');
                //this.trigger('pause', 'blah');
                //this.trigger('pause', 'blah');
                //this.trigger('init', 'blah');
            });



			pm.init();
			pm.trigger('output', { some: 'thing' });
//            pm.trigger('');

        }());
    </script>

</body>
</html>
